<div class="form-container">
  <div class="form-wrapper">
    <header class="form-header">
      <h1 class="form-title">æ–°ã—ã„ã‚«ãƒ•ã‚§ã‚’ç™»éŒ²</h1>
      <p class="form-subtitle">è¨ªã‚ŒãŸã‚«ãƒ•ã‚§ã®æƒ…å ±ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>
    </header>

    <form [formGroup]="cafeForm" (ngSubmit)="onSubmit()" class="form-card">
      <!-- ã‚«ãƒ•ã‚§å -->
      <div class="form-field">
        <label for="name" class="form-label">
          ã‚«ãƒ•ã‚§å
          <span class="form-label-required">*</span>
        </label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="form-input"
          placeholder="ä¾‹: ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ æ¸‹è°·åº—"
          [class.error]="isFieldInvalid('name')"
        />
        @if (isFieldInvalid('name')) {
          <div class="form-error">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z"/>
              <path d="M7.002 11a1 1 0 112 0 1 1 0 01-2 0zM8 3.5a.5.5 0 00-.5.5v4a.5.5 0 001 0V4a.5.5 0 00-.5-.5z"/>
            </svg>
            ã‚«ãƒ•ã‚§åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
        }
      </div>

      <!-- ä½æ‰€ -->
      <div class="form-field">
        <label for="address" class="form-label">
          ä½æ‰€
          <span class="form-label-required">*</span>
        </label>
        <div class="address-search">
          <input
            id="address"
            type="text"
            formControlName="address"
            class="form-input address-input"
            placeholder="ä¾‹: æ±äº¬éƒ½æ¸‹è°·åŒºé“ç„å‚2-3-1"
            [class.error]="isFieldInvalid('address')"
          />
          <button
            type="button"
            class="search-button"
            (click)="searchAddress()"
            [disabled]="!cafeForm.get('address')?.value || isSearching"
          >
            @if (isSearching) {
              <span class="loading-spinner"></span>
            } @else {
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0a8 8 0 100 16A8 8 0 008 0zM8 1.5a6.5 6.5 0 110 13 6.5 6.5 0 010-13z"/>
                <path d="M8 2.5a.5.5 0 00-.5.5v5.5H5a.5.5 0 000 1h3a.5.5 0 00.5-.5V3a.5.5 0 00-.5-.5z"/>
              </svg>
              ä½æ‰€æ¤œç´¢
            }
          </button>
        </div>
        @if (isFieldInvalid('address')) {
          <div class="form-error">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z"/>
              <path d="M7.002 11a1 1 0 112 0 1 1 0 01-2 0zM8 3.5a.5.5 0 00-.5.5v4a.5.5 0 001 0V4a.5.5 0 00-.5-.5z"/>
            </svg>
            ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
        }
        @if (cafeForm.get('latitude')?.value && cafeForm.get('longitude')?.value) {
          <div class="coordinates-display">
            ğŸ“ ç·¯åº¦: {{ cafeForm.get('latitude')?.value }}, çµŒåº¦: {{ cafeForm.get('longitude')?.value }}
          </div>
        }
      </div>

      <!-- è©•ä¾¡ -->
      <div class="form-field">
        <label class="form-label">
          è©•ä¾¡
          <span class="form-label-required">*</span>
        </label>
        <div class="rating-field">
          <div class="rating-stars">
            @for (star of [1, 2, 3, 4, 5]; track star) {
              <button
                type="button"
                class="rating-star"
                [class.active]="cafeForm.get('rating')?.value >= star"
                (click)="setRating(star)"
                [attr.aria-label]="star + 'æ˜Ÿ'"
              >
                â˜…
              </button>
            }
          </div>
          @if (cafeForm.get('rating')?.value) {
            <span class="rating-value">{{ cafeForm.get('rating')?.value }}ç‚¹</span>
          }
        </div>
        @if (isFieldInvalid('rating')) {
          <div class="form-error">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z"/>
              <path d="M7.002 11a1 1 0 112 0 1 1 0 01-2 0zM8 3.5a.5.5 0 00-.5.5v4a.5.5 0 001 0V4a.5.5 0 00-.5-.5z"/>
            </svg>
            è©•ä¾¡ã‚’é¸æŠã—ã¦ãã ã•ã„
          </div>
        }
      </div>

      <!-- ã‚¸ãƒ£ãƒ³ãƒ« -->
      <div class="form-field">
        <label for="genre" class="form-label">ã‚¸ãƒ£ãƒ³ãƒ«</label>
        <div class="form-select-wrapper">
          <select id="genre" formControlName="genre" class="form-select">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="coffee">ã‚³ãƒ¼ãƒ’ãƒ¼å°‚é–€åº—</option>
            <option value="chain">ãƒã‚§ãƒ¼ãƒ³åº—</option>
            <option value="local">å€‹äººçµŒå–¶</option>
            <option value="specialty">ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒ†ã‚£ã‚³ãƒ¼ãƒ’ãƒ¼</option>
            <option value="tea">ç´…èŒ¶ãƒ»æ—¥æœ¬èŒ¶</option>
            <option value="other">ãã®ä»–</option>
          </select>
          <svg class="form-select-arrow" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 01.753 1.659l-4.796 5.48a1 1 0 01-1.506 0z"/>
          </svg>
        </div>
      </div>

      <!-- ãƒ¡ãƒ¢ -->
      <div class="form-field">
        <label for="notes" class="form-label">ãƒ¡ãƒ¢</label>
        <textarea
          id="notes"
          formControlName="notes"
          class="form-textarea"
          placeholder="é›°å›²æ°—ã€å‘³ã€ã‚µãƒ¼ãƒ“ã‚¹ãªã©ã€å°è±¡ã«æ®‹ã£ãŸã“ã¨ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†"
          rows="4"
        ></textarea>
      </div>

      <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="form-actions">
        <a routerLink="/cafes" class="btn-secondary">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </a>
        <button
          type="submit"
          class="btn-primary"
          [disabled]="cafeForm.invalid || isSubmitting"
        >
          @if (isSubmitting) {
            <span class="loading-spinner"></span>
            ä¿å­˜ä¸­...
          } @else {
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M10.97 4.97a.75.75 0 011.07 1.05l-3.99 4.99a.75.75 0 01-1.08.02L4.324 8.384a.75.75 0 111.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 01.02-.022z"/>
            </svg>
            ã‚«ãƒ•ã‚§ã‚’ç™»éŒ²
          }
        </button>
      </div>
    </form>
  </div>
</div>

<!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
@if (showSuccess) {
  <div class="success-message">
    âœ… ã‚«ãƒ•ã‚§ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼
  </div>
}